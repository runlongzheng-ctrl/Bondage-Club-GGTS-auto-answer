console.log("âœ… ç§å¯†èŠå¤©å®¤è‡ªåŠ¨å“åº”è„šæœ¬å·²æ¿€æ´»");

(function () {
    const poseButtonMap = {
        "è·ªä¸‹": "dialog-pose-button-grid-BodyLower-Kneel",
        "èµ·ç«‹": "dialog-pose-button-grid-BodyLower-BaseLower",
        "æ‰“å¼€åŒè…¿": "dialog-pose-button-grid-BodyLower-BaseLower",
        "é—­ä¸ŠåŒè…¿": "dialog-pose-button-grid-BodyLower-LegsClosed",
        "è½»æŠš(caress)è‡ªå·±": "CARESS_SPECIAL",
        "GGTSç§»é™¤äº†GSG-205159èº¯å¹²ä¸Šçš„æ‹˜æŸ": "WEAR_BALLGAG"
    };

    let lastHandled = "";

    function simulateCanvasClick(x, y) {
        const canvas = document.getElementById("MainCanvas");
        if (!canvas) return console.warn("æ‰¾ä¸åˆ°MainCanvasç”»å¸ƒ");

        const rect = canvas.getBoundingClientRect();
        const clientX = rect.left + x;
        const clientY = rect.top + y;

        ["mousedown", "mouseup", "click"].forEach(type => {
            canvas.dispatchEvent(new MouseEvent(type, {
                bubbles: true,
                cancelable: true,
                clientX,
                clientY,
                view: window
            }));
        });

        console.log(`ğŸ–±ï¸ æ¨¡æ‹Ÿç‚¹å‡»åæ ‡: (${x}, ${y})`);
    }

    function clickButtonById(id) {
        const btn = document.getElementById(id);
        if (btn) {
            btn.click();
            console.log(`âœ… ç‚¹å‡»æŒ‰é’®: ${id}`);
        } else {
            console.warn(`âš ï¸ æ‰¾ä¸åˆ°æŒ‰é’®: ${id}`);
        }
    }

    function performExit() {
        // ç›´æ¥ç‚¹å‡»ç”»å¸ƒæŒ‡å®šä½ç½®ä¸¤æ¬¡é€€å‡º
        simulateCanvasClick(636, 15.83);
        setTimeout(() => simulateCanvasClick(636, 15.83), 100);
    }

    function performPoseAction(action) {
        simulateCanvasClick(185, 131.83); // æ‰“å¼€Poseä¸»èœå•

        if (action === "CARESS_SPECIAL") {
            setTimeout(() => simulateCanvasClick(299, 96.83), 300);
            setTimeout(() => simulateCanvasClick(554, 17.83), 600);
            setTimeout(() => clickButtonById("dialog-activities-0-Caress"), 900);
        } else {
            setTimeout(() => clickButtonById("dialog-expression-menubar-next"), 300);
            setTimeout(() => clickButtonById(action), 600);
        }

        setTimeout(performExit, 1200);
    }

    const chatLog = document.getElementById("TextAreaChatLog");
    if (!chatLog) {
        console.warn("âš ï¸ æœªæ£€æµ‹åˆ°èŠå¤©æ¡†ï¼Œå¯èƒ½å°šæœªè¿›å…¥èŠå¤©å®¤");
        return;
    }

    new MutationObserver(mutations => {
        for (const m of mutations) {
            for (const node of m.addedNodes) {
                if (node.nodeType !== Node.ELEMENT_NODE) continue;
                const text = node.innerText;
                if (!text || text === lastHandled) continue;

                lastHandled = text;

                for (const keyword in poseButtonMap) {
                    if (text.includes(keyword)) {
                        const action = poseButtonMap[keyword];
                        if (action === "WEAR_BALLGAG") {
                            console.log("ğŸ¯ è¯†åˆ«åˆ°â€œç§»é™¤æ‹˜æŸâ€ï¼Œè‡ªåŠ¨æˆ´ä¸Šè”æŒ‡æ‰‹å¥—");
                            InventoryWear(Player, "FuturisticGloves", "ItemArms", "Default");

                        } else {
                            performPoseAction(action);
                        }
                        break;
                    }
                }
            }
        }
    }).observe(chatLog, { childList: true, subtree: true });

    console.log("âœ… è‡ªåŠ¨åŠ¨ä½œå“åº”ç›‘å¬ä¸­ï¼ˆå«å£å¡è‡ªåŠ¨æˆ´ä¸Šï¼‰");
})();
